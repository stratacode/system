# Environment file to be source by runTests or runTest if it's run separately

RESULTS_DIR="/jjv/testResults"
VALID_RESULTS="/jjv/StrataCode/test/valid"
# Create a unique name for this test - based on the date plus a suffix to ensure it's unique
TEST_DATE_TAG=$(date +"%Y_%m_%d")

UPDATE=0
STOP_ON_ERROR=0
SCRIPTS=()
SCRIPT_DIR="/jjv/StrataCode/test/scripts"
ECHO_ERRORS=1
ECHO_OUTPUT=0
INPUT_FILE=""
INTERACTIVE=0
IGNORE_ERRORS=0

if [ ! -d $VALIDRESULTS ] ; then
   echo "Valid results directory: $VALIDRESULTS does not exist"
   exit 1
fi

while [[ $# -gt 0 ]]
do
   case $1 in
       --results-dir)
       RESULTS_DIR="$2"
       shift 
       shift 
       ;;
       --tag)
       TEST_RUN_NAME="$2"
       shift 
       shift 
       ;;
       -i|--input)
       INPUT_FILE="$2"
       shift 
       shift 
       ;;
       -u|--update)
       UPDATE=1
       shift
       ;;
       --ignore)
       IGNORE_ERRORS=1
       shift
       ;;
       -p|--prompt)
       INTERACTIVE=1
       shift
       ;;
       -v|--verbose)
       ECHO_ERRORS=1
       ECHO_OUTPUT=1
       echo "Verbose output and errors enabled"
       shift
       ;;
       -q|--quiet)
       ECHO_ERRORS=0
       echo "Quiet mode: no error or test output displayed"
       shift
       ;;
       -s|--stop)
       STOP_ON_ERROR=1
       shift
       ;;
       *)
       # All test options must be in front - Rest of the args go for the list of scripts or the arguments to the command we are running
       while [[ $# -gt 0 ]]
       do
          SCRIPTS+=("$1") 
          shift
       done
       ;;
   esac
done

if [ ! -d $RESULTS_DIR ] ; then
   echo "Test results directory: $RESULTS_DIR does not exist"
   exit 1
fi

# Walk through the other tests run on this date to create a unique name
runIx=0
while [ -d ${RESULTS_DIR}/${TEST_DATE_TAG}_${runIx} ] ; do
   ((runIx++))
done

TEST_RUN_NAME="${TEST_DATE_TAG}_${runIx}"
RUN_DIR="$RESULTS_DIR/$TEST_RUN_NAME"

OUT_DIR="$RESULTS_DIR/$TEST_RUN_NAME/$TEST_RESULTS_NAME"

export RESULTS_DIR
export RUN_DIR
export VALID_RESULTS
export TEST_RUN_NAME
export ECHO_ERRORS
export ECHO_OUTPUT
export INTERACTIVE
export STOP_ON_ERROR
export UPDATE
export IGNORE_ERRORS

